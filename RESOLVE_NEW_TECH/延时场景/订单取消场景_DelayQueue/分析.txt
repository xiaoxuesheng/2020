
订单下单后三十分钟内未支付则自动取消 为业务场景

该场景的代码逻辑分析如下:

1下单后将订单直接放入未支付的延时队列中
2如果超时未支付,则从队列中取出,进行修改为取消状态的订单
3如果支付了,则不去进行取消,或者取消的时候做个状态筛选,即可避免更新
4或者支付完成后,做个主动出队
5还有就是用户主动取消订单,也做个主动出队

总结
这就是单机的不好处,也是一个痛点,所以肯定是不太适合订单量特别大的场景 大家也要酌情考虑和运用
相对于同等量级的数据库轮询操作来说,真是节省了不少数据库的压力和连接,还是值得一用的,我们可以只保存订单的id到延时实例中,这样缩减队列单个实例内存存储